trigger:
  branches:
    include:
      - main
  paths:
    include:
      - SaveTheCat.Frontend/*

variables:
  # Ajusta la ruta a la carpeta del frontend
  appLocation: 'SaveTheCat.Frontend'
  outputLocation: 'dist' # Vite por defecto exporta a 'dist'
  # URL de tu Backend (IMPORTANTE PARA VITE)
  viteApiUrl: 'https://savethecat-prod-api-001-f3b8c0ehbsckashy.brazilsouth-01.azurewebsites.net/api'

pool:
  vmImage: 'ubuntu-latest'

steps:
- checkout: self
  submodules: true

- task: NodeTool@0
  displayName: 'Use Node.js 20'
  inputs:
    versionSpec: '20.x'

- script: npm ci
  displayName: 'Install frontend dependencies'
  workingDirectory: '$(appLocation)'

- script: npm run build
  displayName: 'Build frontend'
  workingDirectory: '$(appLocation)'
  env:
    VITE_API_URL: $(viteApiUrl)

- task: AzureStaticWebApp@0
  displayName: 'Deploy to Static Web App'
  inputs:
    app_location: '$(appLocation)/$(outputLocation)' # Desplegamos la carpeta ya construida
    api_location: '' # Dejamos vac√≠o porque tu API es una Web App separada, no una Azure Function gestionada
    skip_app_build: true # Ya realizamos el build manualmente
  azure_static_web_apps_api_token: $(AZURE_STATIC_WEB_APP_API_TOKEN_PROD)